syntax = "proto3";

package net.imadz.infrastructure.proto;

option java_multiple_files = true;

// Define the Money type
message MoneyPO {
  double amount = 1;
  string currency = 2;
}

// --- Events ---

// Define the BalanceChanged event
message BalanceChangedPO {
  MoneyPO update = 1;
  int64 timestamp = 2;
}

// Define the FundsReserved event
message FundsReservedPO {
  string transferId = 1;
  MoneyPO amount = 2;
}

// Define the FundsDeducted event
message FundsDeductedPO {
  string transferId = 1;
  MoneyPO amount = 2;
}

// Define the ReservationReleased event
message ReservationReleasedPO {
  string transferId = 1;
  MoneyPO amount = 2;
}

// Define the IncomingCreditsRecorded event
message IncomingCreditsRecordedPO {
  string transferId = 1;
  MoneyPO amount = 2;
}

// Define the IncomingCreditsCommited event
message IncomingCreditsCommitedPO {
  string transferId = 1;
}

// Define the IncomingCreditsCanceled event
message IncomingCreditsCanceledPO {
  string transferId = 1;
}

// --- Event Union ---

// Define the CreditBalanceEvent union
message CreditBalanceEventPO {
  oneof event {
    BalanceChangedPO balanceChanged = 1;
    FundsReservedPO fundsReserved = 2;
    FundsDeductedPO fundsDeducted = 3;
    ReservationReleasedPO reservationReleased = 4;
    IncomingCreditsRecordedPO incomingCreditsRecorded = 5;
    IncomingCreditsCommitedPO incomingCreditsCommited = 6;
    IncomingCreditsCanceledPO incomingCreditsCanceled = 7;
  }
}

// --- State Snapshot ---

// Define the CreditBalanceState snapshot
message CreditBalanceStatePO {
  string userId = 1;
  map<string, MoneyPO> accountBalance = 2;
  map<string, MoneyPO> reservedAmount = 3; // Key is transferId
  map<string, MoneyPO> incomingCredits = 4; // Key is transferId
}
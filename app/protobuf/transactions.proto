syntax = "proto3";

package net.imadz.infrastructure.proto;

// 导入 credits.proto 以使用 MoneyPO
import "credits.proto";

option java_multiple_files = true;

// --- Enums ---

enum TransactionStatusPO {
  UNKNOWN = 0;
  NEW = 1;
  INITIATED = 2;
  PREPARED = 3;
  COMPLETED = 4;
  FAILED = 5;
}

// --- Events ---

message TransactionInitiatedPO {
  string fromUserId = 1;
  string toUserId = 2;
  net.imadz.infrastructure.proto.MoneyPO amount = 3;
  int64 timestamp = 4;
}

message TransactionPreparedPO {
  string id = 1;
  int64 timestamp = 2;
}

message TransactionCompletedPO {
  string id = 1;
  int64 timestamp = 2;
}

message TransactionFailedPO {
  string id = 1;
  string reason = 2;
  int64 timestamp = 3;
}

// Define the TransactionEvent union
message TransactionEventPO {
  oneof event {
    TransactionInitiatedPO initiated = 1;
    TransactionPreparedPO prepared = 2;
    TransactionCompletedPO completed = 3;
    TransactionFailedPO failed = 4;
  }
}

// --- State Snapshot ---

message FailedStatusDetailsPO {
  string reason = 1;
}

message TransactionStatusMessagePO {
  TransactionStatusPO status = 1;
  oneof details {
    FailedStatusDetailsPO failed = 2;
  }
}

// Define the TransactionState message (Snapshot)
message TransactionStatePO {
  string id = 1;
  string fromUserId = 2;
  string toUserId = 3;
  net.imadz.infrastructure.proto.MoneyPO amount = 4;
  TransactionStatusMessagePO status = 5;
}
akka {
  persistence {
    journal.plugin = "akka-contrib-mongodb-persistence-journal"
    snapshot-store.plugin = "akka-contrib-mongodb-persistence-snapshot"
  }

  # ... 保持您原有的 Mongo 连接配置不变 ...
  contrib.persistence.mongodb.mongo {
    mongouri = "mongodb://127.0.0.1:27017/cqrs-demo-journal?maxPoolSize=20&w=majority&authSource=admin"
    suffix-builder {
      separator = "_"
      class = "net.imadz.infrastructure.SuffixCollectionNames"
    }
  }
}

# ==========================================================
# [新增] 插件专属配置块：注册 Event Adapters
# ==========================================================
akka-contrib-mongodb-persistence-journal {

  # 1. 注册适配器 (给类起个名字)
  event-adapters {
    # 针对 StepExecutor 的适配器 (粘合剂)
    step-adapter = "net.imadz.infra.saga.persistence.StepExecutorEventAdapter"

    # 针对 Coordinator 的适配器 (如果您也想把它改成配置驱动)
    coordinator-adapter = "net.imadz.infra.saga.persistence.SagaTransactionCoordinatorEventAdapter"
  }

  # 2. 绑定适配器 (将 Event 类型映射到适配器名)
  event-adapter-bindings {
    # 绑定 StepExecutor 的事件
    "net.imadz.infra.saga.StepExecutor$Event" = step-adapter

    # 绑定 SagaTransactionCoordinator 的事件
    "net.imadz.infra.saga.SagaTransactionCoordinator$Event" = coordinator-adapter
  }
}